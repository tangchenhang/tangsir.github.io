<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>文件提交系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- 图标库 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

<style>
/* ================= 全局基础 ================= */
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    background: linear-gradient(180deg, #f0fdf4, #f8fafc);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
    color: #1f2937;
}

/* ================= 页面容器 ================= */
.center-page {
    max-width: 520px;
    margin: 32px auto;
    padding: 22px;
    background: #ffffff;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,.06);
}

/* ================= 标题 ================= */
.title {
    text-align: center;
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 18px;
    color: #059669;
}

/* ================= 表单 ================= */
input[type="text"],
input[type="password"],
input[type="number"],
select {
    width: 100%;
    padding: 14px 16px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid #d1d5db;
    margin-top: 12px;
    transition: 0.2s;
}

input:focus {
    outline: none;
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16,185,129,.15);
}

/* ================= 按钮系统 ================= */
.btn {
    width: 100%;
    height: 50px;
    margin-top: 14px;
    border: none;
    border-radius: 14px;
    background: linear-gradient(135deg,#10b981,#059669);
    color: #fff;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    transition: .25s;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(16,185,129,.3);
}

.btn-small {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #10b981;
    color: white;
    margin-right: 8px;
}

.btn-small:hover {
    background: #059669;
}

.btn-danger {
    background: linear-gradient(135deg,#ef4444,#dc2626) !important;
}

.btn-danger:hover {
    box-shadow: 0 6px 14px rgba(239,68,68,.35);
}

/* ================= 状态徽章 ================= */
.badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 14px;
    font-weight: 600;
    color: white;
    background: #10b981;
}

/* ================= 区块标题 ================= */
.section-title {
    margin: 22px 0 10px;
    font-size: 20px;
    font-weight: 700;
    color: #047857;
}

/* ================= 上传区域 ================= */
#upload-area {
    margin-top: 14px;
    padding: 28px 10px;
    border-radius: 16px;
    border: 2px dashed #a7f3d0;
    background: #f0fdf4;
    text-align: center;
    color: #065f46;
    font-size: 15px;
}

#upload-area:hover {
    border-color: #10b981;
}

/* ================= 文件预览 ================= */
.file-preview-img {
    width: 90px;
    height: 90px;
    border-radius: 12px;
    object-fit: cover;
    margin: 8px 8px 0 0;
    box-shadow: 0 4px 10px rgba(0,0,0,.1);
}

/* ================= 名单列表（重点美化） ================= */
#owner-list {
    margin-top: 10px;
}

.grid-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    margin-bottom: 12px;
    border-radius: 16px;
    background: #ffffff;
    box-shadow: 0 6px 16px rgba(0,0,0,.05);
    border-left: 6px solid #10b981;
}

.grid-row:nth-child(even) {
    background: #f0fdf4;
}

/* 左侧信息 */
.grid-row > div:nth-child(1) {
    font-size: 17px;
    font-weight: 700;
    width: 70px;
}

/* 提交状态 */
.grid-row > div:nth-child(2) span {
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
}

/* 时间 & 数量 */
.grid-row > div:nth-child(3),
.grid-row > div:nth-child(4) {
    font-size: 13px;
    color: #6b7280;
    text-align: center;
    widthj : 80px;
}

/* 操作按钮区 */
.grid-row > div:nth-child(5) {
    display: flex;
    gap: 6px;
}

/* ================= 弹窗 ================= */
#reset-dialog {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    justify-content: center;
    align-items: center;
}
#reset-dialog:not(.hidden) {
    display: flex;
}



#reset-dialog > div {
    animation: popup .25s ease;
}

@keyframes popup {
    from {
        transform: scale(.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* ================= 隐藏 ================= */
.hidden {
    display: none;
}
/* ================= 结束系统按钮美化 ================= */
#btn-end {
    width: 100%;
    height: 50px;
    margin-top: 14px;
    border: none;
    border-radius: 14px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;

    color: #fff;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 6px 18px rgba(239,68,68,.35);

    transition: all .25s ease;
}

#btn-end:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(239,68,68,.45);
}

#btn-end:active {
    transform: scale(.98);
}
/* ================= 返回按钮（次级） ================= */
.btn-back {
    width: auto;
    min-width: 120px;
    height: 44px;
    margin-top: 18px;

    padding: 0 22px;
    border-radius: 14px;

    font-size: 15px;
    font-weight: 600;

    background: #ffffff;
    color: #059669;

    border: 2px solid #a7f3d0;
    cursor: pointer;

    transition: all .25s ease;
}

.btn-back:hover {
    background: #ecfdf5;
    border-color: #10b981;
    transform: translateY(-1px);
}

.btn-back:active {
    transform: scale(.97);
}


</style>
</head>

<body>

<!-- ========== 首页 ========== -->
<div id="page-home" class="center-page">
    <div class="title">文件提交系统</div>

    <button class="btn" onclick="goVisitor()">我是访客</button>
    <button class="btn" onclick="goOwnerLogin()">我是房主</button>
</div>



<!-- ========== 访客验证 ========== -->
<div id="page-visitor-verify" class="center-page hidden">
    <div class="title">访客验证</div>
    <input id="visitor-name-input" placeholder="请输入姓名">
    <button class="btn" onclick="visitor.verify()">下一步</button>
    <button class="btn-back" onclick="goHome()">返回</button>

</div>


<!-- ========== 访客提交 ========== -->
<div id="page-visitor-submit" class="center-page hidden">
    <div class="title">文件提交</div>
    <div>最多上传 <span id="visitor-max-files">1</span> 个文件</div>

    <div id="upload-area">拖拽文件到此 或 点击下方按钮</div>
    <input type="file" id="visitor-file-input" multiple>

    <div id="visitor-file-list" style="margin-top:10px;"></div>

    <button class="btn" onclick="visitor.submit()">提交文件</button>
    <button class="btn-back" onclick="goHome()">返回</button>

</div>


<!-- ========== 访客查看已提交文件 ========== -->
<div id="page-visitor-view" class="center-page hidden">
    <div class="title">我的文件</div>
    <div id="visitor-thanks" class="visitor-thanks hidden"></div>
    <div id="visitor-files-display"></div>
   <button class="btn-back" onclick="goHome()">返回</button>

</div>



<!-- ========== 房主登录 ========== -->
<div id="page-owner-login" class="center-page hidden">
    <div class="title">房主登录</div>
    <input id="owner-pass-input" placeholder="请输入房主密码" type="password">
    <button class="btn" onclick="owner.login()">进入管理界面</button>
    <button class="btn-back" onclick="goHome()">返回</button>

</div>


<!-- ========== 房主仪表盘 ========== -->
<div id="page-owner-dashboard" class="center-page hidden">
    <div class="title">房主管理界面</div>

    <div>
        系统状态：<span id="sys-status-badge" class="badge">未知</span>
    </div>

    <!-- 控制按钮 -->
    <button id="btn-start" class="btn">开始系统</button>
    <button id="btn-pause" class="btn">暂停系统</button>
    <button id="btn-resume" class="btn">恢复系统</button>
    <button id="btn-end" class="btn-danger">结束系统</button>

    <div class="section-title">名单管理</div>
    <input id="add-name-input" placeholder="输入姓名以添加">
    <button class="btn" onclick="owner.addName()">
    添加到名单
</button>
    <button class="btn-back" onclick="goHome()">返回</button>


    <div style="margin-top:12px;">
        上传数量限制：
        <input id="max-files-input" type="number" min="1">
        <button class="btn-small" onclick="system.setMaxFiles()">保存</button>
    </div>

    <div style="margin-top:12px;">
        提交后允许修改：
        <input type="checkbox" id="allow-modify-checkbox" onchange="owner.updateAllowModify()">
    </div>

    <div class="section-title">搜索</div>
    <input id="owner-search-input" placeholder="输入名字搜索" oninput="refreshDashboard()">

    <div class="section-title">操作</div>
    <button class="btn-small" onclick="owner.exportAll()">导出全部文件</button>
    <button class="btn-small btn-danger" onclick="owner.showResetDialog()">重置系统</button>

    <div class="section-title">名单列表（已提交排前）</div>
    <div id="owner-list"></div>

    <button class="btn-small" onclick="goHome()">返回首页</button>
</div>



<!-- ========== 弹窗（重置用） ========== -->
<!-- ❗ 已修复：删除了 display:none -->
<div id="reset-dialog" class="hidden" style="
    position: fixed;
    left:0; top:0; right:0; bottom:0;
    background: rgba(0,0,0,0.45);
    justify-content:center;
    align-items:center;
">
    <div style="background:white;padding:20px;border-radius:14px;width:320px;">
        <div class="title" style="font-size:20px;">重置系统</div>
        <p>请选择重置方式：</p>

        <button class="btn-small btn-danger" onclick="owner.resetAll()">删除名单 + 文件</button>
        <button class="btn-small" onclick="owner.resetFilesOnly()">只删除文件</button>
        <button class="btn-small" onclick="owner.hideResetDialog()">取消</button>
    </div>
</div>


<!-- LeanCloud -->
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>

<!-- 你的 JS -->
<script src="file-submit2.js"></script>

</body>
</html>
